#!/bin/bash

###############################################################################
# Enhanced UI Complete Setup Script
# This script creates all enhanced UI files automatically
# 
# Usage: 
#   chmod +x setup-enhanced-ui.sh
#   ./setup-enhanced-ui.sh
###############################################################################

# Colors
GREEN='\033[0;32m'
BLUE='\033[0;34m'
YELLOW='\033[1;33m'
RED='\033[0;31m'
NC='\033[0m'

echo -e "${BLUE}"
cat << "EOF"
‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó
‚ïë         üé® Enhanced UI Setup Script v1.0               ‚ïë
‚ïë     Automated Setup for All Enhanced UI Components      ‚ïë
‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù
EOF
echo -e "${NC}"

# Check directory
if [ ! -d "frontend/src/Pages" ]; then
    echo -e "${RED}‚ùå Error: frontend/src/Pages directory not found!${NC}"
    echo -e "${YELLOW}Please run this script from the project root directory.${NC}"
    exit 1
fi

# Create backup
BACKUP_DIR="frontend/src/Pages/_backup_$(date +%s)"
mkdir -p "$BACKUP_DIR"
echo -e "${BLUE}üì¶ Backup directory: $BACKUP_DIR${NC}\n"

# Counter
FILES_CREATED=0

# Function to backup and create file
create_file() {
    local FILE_PATH="$1"
    local DIR_PATH=$(dirname "$FILE_PATH")
    
    mkdir -p "$DIR_PATH"
    
    if [ -f "$FILE_PATH" ]; then
        cp "$FILE_PATH" "$BACKUP_DIR/$(basename $FILE_PATH).backup"
    fi
    
    cat > "$FILE_PATH"
    ((FILES_CREATED++))
    echo -e "${GREEN}‚úÖ Created: $FILE_PATH${NC}"
}

# Create Signup.jsx
echo -e "\n${BLUE}üìù Creating Signup files...${NC}"
create_file "frontend/src/Pages/Signup/Signup.jsx" << 'EOF'
import { useState, useEffect } from "react";
import { useDispatch, useSelector } from "react-redux";
import { useNavigate } from "react-router-dom";
import { signupUser, clearError } from "../../features/userSlice";
import styles from "./Signup.module.css";

function Signup() {
  const dispatch = useDispatch();
  const navigate = useNavigate();
  const { loading, error, user } = useSelector((state) => state.user);

  const [formData, setFormData] = useState({
    fullname: "", email: "", password: "", rollNumber: "",
    gender: "", dob: "", address: "", phone: "", role: "student",
  });

  const [validationError, setValidationError] = useState("");
  const [showPassword, setShowPassword] = useState(false);

  useEffect(() => { dispatch(clearError()); }, [dispatch]);
  useEffect(() => {
    if (user?.role === "student") navigate("/student-dashboard", { replace: true });
  }, [user, navigate]);

  const handleChange = (e) => {
    const { name, value } = e.target;
    if (name === "rollNumber") {
      setFormData((prev) => ({ ...prev, [name]: value.toUpperCase() }));
    } else {
      setFormData((prev) => ({ ...prev, [name]: value }));
    }
    if (validationError) setValidationError("");
  };

  const validateRollNumber = (rollNumber) => /^2K\d{2}-(CS|IT|EE|ME|CE)-\d+$/i.test(rollNumber);
  const validatePhone = (phone) => /^0\d{3}-\d{7}$/.test(phone);

  const handleSubmit = (e) => {
    e.preventDefault();
    setValidationError("");
    if (!formData.fullname || !formData.email || !formData.password || !formData.rollNumber || !formData.gender || !formData.dob || !formData.address || !formData.phone) {
      setValidationError("All fields are required");
      return;
    }
    if (!validateRollNumber(formData.rollNumber)) {
      setValidationError("Invalid roll number. Use: 2K26-IT-1");
      return;
    }
    if (!validatePhone(formData.phone)) {
      setValidationError("Invalid phone. Use: 0316-3280715");
      return;
    }
    if (formData.password.length < 6) {
      setValidationError("Password must be 6+ characters");
      return;
    }
    dispatch(signupUser(formData));
  };

  return (
    <div className={styles.signupContainer}>
      <div className={styles.signupCard}>
        <div className={styles.headerSection}>
          <div className={styles.iconWrapper}><i className="bi bi-person-plus"></i></div>
          <h2 className={styles.title}>Create Student Account</h2>
          <p className={styles.subtitle}>Join thousands of students</p>
        </div>
        {(error || validationError) && (
          <div className={styles.errorAlert}>
            <i className="bi bi-exclamation-circle"></i>
            <span>{validationError || error}</span>
          </div>
        )}
        <form onSubmit={handleSubmit} className={styles.form}>
          <div className={styles.formGroup}>
            <label className={styles.label}><i className="bi bi-person"></i> Full Name *</label>
            <input type="text" name="fullname" value={formData.fullname} placeholder="Full name" className={styles.input} onChange={handleChange} required />
          </div>
          <div className={styles.formGroup}>
            <label className={styles.label}><i className="bi bi-envelope"></i> Email *</label>
            <input type="email" name="email" value={formData.email} placeholder="email@university.edu" className={styles.input} onChange={handleChange} required />
          </div>
          <div className={styles.formGroup}>
            <label className={styles.label}><i className="bi bi-lock"></i> Password *</label>
            <div className={styles.passwordWrapper}>
              <input type={showPassword ? "text" : "password"} name="password" value={formData.password} placeholder="6+ characters" className={styles.input} onChange={handleChange} required />
              <button type="button" className={styles.passwordToggle} onClick={() => setShowPassword(!showPassword)}>
                <i className={`bi ${showPassword ? 'bi-eye-slash' : 'bi-eye'}`}></i>
              </button>
            </div>
          </div>
          <div className={styles.formGroup}>
            <label className={styles.label}><i className="bi bi-card-text"></i> Roll Number *</label>
            <input type="text" name="rollNumber" value={formData.rollNumber} placeholder="2K26-IT-1" className={`${styles.input} ${styles.uppercase}`} onChange={handleChange} required />
            <small className={styles.hint}>Format: 2K26-IT-1 (CS, IT, EE, ME, CE)</small>
          </div>
          <div className={styles.twoColumn}>
            <div className={styles.formGroup}>
              <label className={styles.label}><i className="bi bi-gender-ambiguous"></i> Gender *</label>
              <select name="gender" value={formData.gender} className={styles.select} onChange={handleChange} required>
                <option value="">Select</option>
                <option value="Male">Male</option>
                <option value="Female">Female</option>
                <option value="Other">Other</option>
              </select>
            </div>
            <div className={styles.formGroup}>
              <label className={styles.label}><i className="bi bi-calendar"></i> DOB *</label>
              <input type="date" name="dob" value={formData.dob} className={styles.input} max={new Date().toISOString().split("T")[0]} onChange={handleChange} required />
            </div>
          </div>
          <div className={styles.formGroup}>
            <label className={styles.label}><i className="bi bi-telephone"></i> Phone *</label>
            <input type="tel" name="phone" value={formData.phone} placeholder="0316-3280715" className={styles.input} onChange={handleChange} required />
            <small className={styles.hint}>Format: 0316-3280715</small>
          </div>
          <div className={styles.formGroup}>
            <label className={styles.label}><i className="bi bi-geo-alt"></i> Address *</label>
            <textarea name="address" value={formData.address} placeholder="Complete address" className={styles.textarea} rows="2" onChange={handleChange} required />
          </div>
          <button type="submit" className={styles.submitBtn} disabled={loading}>
            {loading ? (<><span className={styles.spinner}></span> Creating...</>) : (<><span>Create Account</span><i className="bi bi-arrow-right"></i></>)}
          </button>
          <div className={styles.footer}>
            <p>Already have account? <a href="/login" className={styles.link}>Login</a></p>
          </div>
        </form>
      </div>
    </div>
  );
}
export default Signup;
EOF

# Create Signup.module.css (abbreviated for brevity - see full version in artifacts above)
create_file "frontend/src/Pages/Signup/Signup.module.css" << 'EOF'
.signupContainer{min-height:100vh;display:flex;align-items:center;justify-content:center;padding:40px 20px;background:linear-gradient(135deg,var(--primaryLight-color) 0%,var(--secondary-color) 100%)}
.signupCard{width:100%;max-width:600px;background:#fff;border-radius:20px;padding:40px;box-shadow:0 10px 40px rgba(0,0,0,.1);animation:slideUp .5s ease-out}
@keyframes slideUp{from{opacity:0;transform:translateY(30px)}to{opacity:1;transform:translateY(0)}}
.headerSection{text-align:center;margin-bottom:30px}
.iconWrapper{width:60px;height:60px;background:var(--primaryLight-color);border-radius:50%;display:flex;align-items:center;justify-content:center;margin:0 auto 20px}
.iconWrapper i{font-size:28px;color:var(--primary-color)}
.title{font-size:28px;font-weight:700;color:var(--text-color2);margin-bottom:8px}
.subtitle{font-size:16px;color:#718096;margin:0}
.errorAlert{background:#fee;border:1px solid #fcc;color:#c53030;padding:12px 16px;border-radius:10px;display:flex;align-items:center;gap:10px;margin-bottom:20px;animation:shake .4s ease-out}
@keyframes shake{0%,100%{transform:translateX(0)}25%{transform:translateX(-8px)}75%{transform:translateX(8px)}}
.form{display:flex;flex-direction:column;gap:20px}
.formGroup{display:flex;flex-direction:column;gap:8px}
.label{font-size:14px;font-weight:600;color:var(--text-color2);display:flex;align-items:center;gap:6px}
.label i{color:var(--primary-color);font-size:16px}
.input,.select,.textarea{padding:12px 16px;border:2px solid #e2e8f0;border-radius:10px;font-size:15px;color:var(--text-color2);transition:all .3s ease;background:#fff;font-family:inherit}
.input:focus,.select:focus,.textarea:focus{outline:0;border-color:var(--primary-color);box-shadow:0 0 0 3px var(--primaryLight-color)}
.uppercase{text-transform:uppercase}
.select{cursor:pointer;appearance:none;background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3E%3Cpath stroke='%23667eea' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='M6 8l4 4 4-4'/%3E%3C/svg%3E");background-position:right 12px center;background-repeat:no-repeat;background-size:20px;padding-right:40px}
.textarea{resize:vertical;min-height:60px}
.hint{font-size:12px;color:#a0aec0;margin-top:-4px}
.passwordWrapper{position:relative;display:flex;align-items:center}
.passwordToggle{position:absolute;right:12px;background:0 0;border:0;cursor:pointer;color:#a0aec0;padding:8px;display:flex;align-items:center;justify-content:center;transition:color .2s}
.passwordToggle:hover{color:var(--primary-color)}
.twoColumn{display:grid;grid-template-columns:1fr 1fr;gap:16px}
.submitBtn{width:100%;padding:14px 24px;background:var(--primary-color);color:#fff;border:0;border-radius:10px;font-size:16px;font-weight:600;cursor:pointer;transition:all .3s ease;display:flex;align-items:center;justify-content:center;gap:10px;margin-top:10px}
.submitBtn:hover:not(:disabled){transform:translateY(-2px);box-shadow:0 6px 20px rgba(109,0,255,.3)}
.submitBtn:disabled{opacity:.7;cursor:not-allowed}
.spinner{width:18px;height:18px;border:2px solid rgba(255,255,255,.3);border-top-color:#fff;border-radius:50%;animation:spin .8s linear infinite}
@keyframes spin{to{transform:rotate(360deg)}}
.footer{text-align:center;margin-top:20px;color:#718096;font-size:14px}
.link{color:var(--primary-color);text-decoration:none;font-weight:600}
@media (max-width:768px){.signupCard{padding:30px 20px}.title{font-size:24px}.twoColumn{grid-template-columns:1fr}}
EOF

echo -e "\n${GREEN}‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê${NC}"
echo -e "${GREEN}‚úÖ Setup Complete! Created $FILES_CREATED files${NC}"
echo -e "${GREEN}‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê${NC}\n"

echo -e "${BLUE}üìã Next Steps:${NC}"
echo -e "  1. cd frontend"
echo -e "  2. npm run dev"
echo -e "  3. Visit your pages to see enhanced UI!\n"

echo -e "${YELLOW}üíæ Backups saved to: $BACKUP_DIR${NC}\n"

echo -e "${BLUE}üìù Note: Due to size limits, this script created Signup files.${NC}"
echo -e "${BLUE}For Login, StudentDashboard, AdminDashboard, DepartmentDashboard:${NC}"
echo -e "${BLUE}Please copy from the artifacts above in the conversation.${NC}\n"

exit 0
